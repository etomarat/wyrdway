# Road Trip Roguelite (TIC-80) — GDD v0.1

## 1) Концепция
**Коротко:** аркадная езда + менеджмент ресурсов + короткие вылазки на POI + гараж/апгрейды. Вайб: *Pacific Drive × mini‑Zomboid*, но компактно и «по-тик80шному».

**Цель игрока:** пройти цепочку зон (регионов), добывая ресурсы/детали, улучшая машину и выживая в аномалиях.

## 2) Дизайн‑пиллары
1. **Импакт управления**: машина ощущается весом — дрифт, занос, дым, искры, скрин‑шейк.
2. **Риск‑награда**: чем дольше в POI/в зоне, тем опаснее, но тем лучше лут.
3. **Машина = персонаж**: состояние и сборка машины определяют стиль прохождения.
4. **Процедурность без боли**: мир генерится как граф/узлы, а не бесшовная огромная карта.
5. **Расширяемость**: новые враги/POI/апгрейды добавляются через таблицы данных.

## 3) Платформа и ограничения
**Платформа:** TIC‑80 (Lua).
- Экран 240×136, 16 цветов, тайловая карта.
- Ограничиваем размер контента, избегаем тяжёлой физики.

## 4) Игровая петля (core loop)
1. **Гараж**: ремонт, крафт/установка модулей, выбор маршрута (регион).
2. **Карта региона (узлы)**: выбираем следующий узел (дорога/POI/опасность/выход).
3. **Езда (дорога)**: аркадное управление, угрозы на трассе, расход ресурсов.
4. **POI‑вылазка**: короткий пеший рейд (30–90 сек) — лут, взаимодействия, риск растёт.
5. **Экстракшн**: вернуться к машине и уехать → сохранить лут и прогресс.
6. Повторять, пока не пройдём регион/не сломаемся.

## 5) Сцены/экраны
- **TITLE**: старт/настройки.
- **GARAGE**: ремонт/апгрейды/инвентарь.
- **REGION MAP**: узлы, маршрут, прогноз угроз.
- **DRIVE**: езда по сегменту дороги.
- **POI**: пешая зона.
- **RESULT**: итоги сегмента/награды/повреждения.

### Варианты подачи DRIVE (эксперимент)
Мы будем пробовать **оба** варианта и выберем лучший по ощущениям управления и читаемости.

**A) Top-down DRIVE (классический)**
- Машина едет по 2D тайловой дороге, камера скроллится.
- Плюсы: проще реализация и коллизии.

**B) Pseudo-3D DRIVE (кокпит, как OutRun / “A LONG DRIVE”)**
- Дорога рисуется в перспективе (scanline/row-based), кокпит — оверлей.
- Мир DRIVE моделируется как 1D прогресс по сегменту + боковое смещение + профиль поворотов.
- Препятствия/аномалии — billboard-спрайты со скейлом по глубине.
- Плюсы: сильнее вайб Pacific Drive, больше «импакта».
- Минусы: сложнее код езды (примерно ×2–3 к top-down), нужна аккуратная настройка.

**Важно:** режим **POI** остаётся top-down, чтобы не удваивать объём проекта.

## 6) Управление
### В режиме езды
- Стрелки: газ/тормоз/поворот
- A: ручник/дрифт (или ускорение)
- B: активный модуль (EMP/щит/форсаж/дым)

### В режиме POI
- Стрелки: ходьба
- A: взаимодействие (открыть/взять/взлом)
- B: быстрый слот (фонарь/сканер/медкит)

## 7) Ресурсы и состояния

### Ресурсы (экономика)
- **scrap** (металл)
- **electronics** (электроника)
- **chem** (химия)
- **fuel** (бензин)

### Система повреждений машины (детали вместо «одного HP»)
Чтобы сохранить «ощущение машины» как в Pacific Drive, урон считается **по нескольким ключевым деталям** (без избыточной симуляции).

**Минимальный набор деталей (v0):**
- **body** (кузов/панели)
- **engine** (двигатель)
- **tires** (шины/сцепление)
- **battery** (аккумулятор/электрика)
- **fuel_tank** (бак)
- **suspension** (подвеска/управляемость)

**Почему так укладывается в геймплей:**
- Каждая деталь напрямую влияет на управление/менеджмент.
- Игрок видит понятные последствия и может планировать ремонт/апгрейд.
- Реализация — это 6 чисел + несколько статусов, что нормально для TIC-80.

**Статусы деталей (примеры):**
- *leak* (течь топлива) → расход fuel ↑
- *short* (коротит) → battery ↓ быстрее, активки иногда «фейлят»
- *wobble* (биение) → уводит руль, занос ↑
- *overheat* (перегрев) → мощность ↓, heat ↑

**Источники урона (привязка к ощущению):**
- Столкновения → body/suspension, иногда tires.
- Мины/шипы → tires.
- Электро-аномалии → battery/engine (коротит).
- Стеклянный дождь → body, шанс прокола.
- Паразит/пиявка → battery/fuel.

**Ремонт и замена:**
- В дороге — быстрый ремонт расходниками (частичный): *patch kit*, *tape*, *fuse*.
- В гараже — полный ремонт и/или **замена детали** (требует ресурсов).

### Шкалы (для HUD)
- **fuel** (топливо)
- **battery** (электричество)
- **heat** (перегрев/стресс)
- **body_hp**, **engine_hp**, **tires_hp**, **tank_hp**, **suspension_hp**

## 8) Инвентарь и лут
- Инвентарь ограничен (**capacity**). Опционально: «тетрис‑рюкзак».
- Лут делится на:
  - **Материалы** (scrap/electronics/chem)
  - **Детали** (колёса, предохранители, ремень, свечи)
  - **Модули** (уникальные апгрейды)
  - **Расходники** (ремкомплект, канистра, шип‑лента)

## 9) Апгрейды

### Формат
Апгрейд = **пассивные модификаторы** + (опционально) **активка**.

### Слоты и «навесные панели» (важно для ощущения поломок)
Чтобы получить эффект «оторвало бампер / сняло дверь / выбило багажник», вводим простую систему **панелей покрытия** (coverage) — без тяжёлой симуляции.

**Панели (v0):**
- **front_bumper** (передний бампер)
- **rear_bumper** (задний бампер)
- **left_door**, **right_door** (двери)
- **hood** (капот)
- **trunk** (багажник)

Каждая панель имеет:
- `hp` (прочность)
- `coverage` (какие детали она защищает)
- `on_detach` (что меняется, когда панель оторвалась)

### Роутинг урона (hit routing)
При попадании урона вычисляем:
1) **куда** пришёл удар (front/rear/side/top) и **тип** удара (collision, shrapnel, electric, puncture).
2) Если соответствующая панель существует и жива → **часть урона уходит в панель**, остаток — в защищаемые детали.
3) Если панели нет/оторвана → урон идёт **прямо в детали**, а также может дать спец-эффекты.

### Эффекты от потери панелей (примеры)
- **Нет front_bumper** → столкновения чаще пробивают в **engine/suspension**.
- **Нет hood** → повышенный шанс урона по **engine** от осколков/дождя.
- **Нет дверей** → в POI/при электрических ударах повышается риск урона **игроку** (если пеший режим активен) или «стан/контроль» (если считаем игрока как абстракт).
- **Нет trunk** → шанс **потери части лута** при сильном ударе (loot drop) или уменьшение capacity.

### Loot drop (упрощённо)
Механика падения лута делается так:
- Триггер: сильный удар (damage ≥ threshold) **и** trunk отсутствует/сломана.
- Эффект: 1 предмет/часть ресурсов выпадает на дорогу (можно подобрать, но рискованно).
- Для экономии: вместо физики можно спавнить 1 «пакет лута» и таймер исчезновения.

### Базовые слоты модулей
- **engine_slot**, **battery_slot**, **tires_slot**, **utility_slot1/2**, **cargo_slot**

### Примеры апгрейдов
- **Reinforced Bumper**: +hp панели front_bumper, -урон от лобовых столкновений.
- **Better Tires**: +сцепление, -занос.
- **EMP Pulse (active)**: глушит дронов/электро-турели на 2–4 сек (тратит battery).
- **Shield (active)**: краткий щит от разрядов/осколков (heat ↑).
- **Scanner**: подсветка мин/контейнеров (battery ↓).

## 10) Враги/угрозы
### Категории
1) **Anomalies (hazards)** — не убиваются, только обойти/подавить/пережить.
2) **Drones/Turrets** — выводятся из строя (EMP/лом) и иногда уничтожаются.
3) **Chasers** — гонятся и таранят; чаще «сорвать погоню», иногда уничтожить.

### Примеры
- **Scrap Mines**: мины на дороге → урон шинам/искры.
- **Glass Storm**: периодический «дождь» → урон кузову, сцепление хуже.
- **Magnetic Field**: тянет мусор → микростолкновения, дрожь руля.
- **Watcher Drone**: конус зрения, разряды на дистанции.
- **Scrap Hound**: охотник-таран сзади.
- **Leech**: паразит цепляется в POI → жрёт fuel/battery, снимается манёвром/в гараже.

## 11) POI (точки интереса)
POI — маленькая зона (1–2 экрана) + контейнеры + «опасность по таймеру».

### Типы POI
- **Gas Station**: топливо/канистры/шанс сигнализации.
- **Workshop Shed**: scrap + шанс модуля ремонта.
- **Power Box**: электроника/предохранители, мини‑пазл «включить питание».
- **Derelict Car**: деталь/колёса/редкий модуль.
- **Anomaly Shrine**: артефакт, но сильная опасность.
- **Checkpoint**: охрана (дроны/турели), высокий лут.

## 12) Процедурная генерация
### Структура региона
Регион = **граф узлов** (10–20). Узлы: DRIVE, POI, HAZARD, EXIT.

### Генерация
- Сначала строим «хребет маршрута» от START к EXIT.
- Затем добавляем ответвления для риска/награды.
- Для каждого узла выбираем **биом/набор угроз** + таблицу лута.

### Рост опасности
- Внутри региона растёт «аномальная активность» (difficulty tier).
- В POI риск растёт с временем (таймер): больше разрядов/дронов/помех.

## 13) Прогрессия и мета

### Модель провала (death/fail state) — «современно, но напряжённо»
**Выбрано по умолчанию: вариант 2 (рекомендуемый).**

- Провал в регионе/поездке = **эвакуация в гараж**.
- **Мета-прогресс сохраняется**: открытые чертежи/разблокировки остаются.
- **Лут из текущей поездки не гарантирован**: теряется «незакреплённая добыча», которую не успел доставить и зафиксировать в гараже.
- Машина возвращается **с поломками** (несколько деталей в красной зоне), ремонт требует ресурсов.

#### Закрепление прогресса
- Всё, что привезено в гараж, становится **secure** (сохраняется постоянно).
- Поездка = игра «на риск»: чем дальше и дольше, тем выше награда, но тем больнее провал.

#### Страховка (anti-frustration)
- 1 слот **insured cargo**: выбранный предмет/пакет ресурсов не теряется при провале.
- Опциональный расходник **recovery beacon**: при провале возвращает часть добычи (настройка баланса ниже).

#### Стартовые цифры баланса (v0, можно крутить)
> Цель: провал неприятен, но не «всё зря». Числа сделаны так, чтобы игрок чаще терял **временную** добычу, но сохранял **долгосрочные** открытия.

- Потеря при провале: **80% незакреплённого** (random) + **100% временных артефактов/квест-лутин** (если такие появятся), **кроме insured cargo**.
- Гарантированно остаётся: **20% незакреплённого** (random), чтобы провал всё равно «чуть продвигал».
- Эвакуация (штраф): **10% текущего запасённого топлива** (min 5) + **5 scrap** (если есть; иначе долг/минус).
- Повреждения после эвакуации: случайно **2 детали** получают состояние *critical* (HP = 1–2), ещё **1 панель** может оторваться.
- Стоимость ремонта в гараже (ориентиры):
  - мелкий ремонт детали: **2–4 scrap**
  - восстановление панели: **3–6 scrap**
  - починка электрики: **2–3 electronics**
  - устранение течи бака: **1–2 chem** + **1 scrap**
- **recovery beacon**: при провале сохраняет **ещё +30%** незакреплённого (итого ~50% сохраняется), но занимает utility слот на поездку.

### Run-based прогресс
- Основной прогресс — через добычу ресурсов/деталей и установку модулей.

### Гараж-прогресс
- Открытие новых апгрейдов (чертежи) за найденные артефакты.

### Баланс
- Игрок может «откатиться» и дофармить ранние регионы, но с меньшей наградой.

## 14) UI и читаемость
- HUD в DRIVE: speed, fuel, battery, heat, hp_body, hp_tires + индикатор активки.
- HUD в POI: таймер опасности, быстрые подсказки взаимодействий.
- Карта региона: узлы, риск/награда (иконки), выбранный маршрут.

## 15) Juice/эффекты
- **Smoke particles** при дрифте/буксе.
- **Sparks** при касании препятствий/таране.
- **Screen shake** при ударах/взрывах.
- **Skid marks** (упрощённо: следы точками/короткими линиями).
- Звук: визг шин, глухие удары, «электро‑щелчки».

## 16) Расширяемость (контент через таблицы)
Контент в данных:
- `ENEMIES[id] = {hp, speed, kind, ai, loot, on_hit, on_disable}`
- `POIS[id] = {layout, loot_table, guards, hazard_mods, time_pressure}`
- `UPGRADES[id] = {slots, passive_mods, active, cost, unlock}`
- `LOOT_TABLES[id] = {weights...}`

Поведение через небольшие функции `AI.*` и события (минимальный event bus):
- `emit('on_hit', data)`
- `emit('on_enter_zone', data)`
- `emit('on_use_active', data)`

## 17) Архитектурные решения v0 (фиксируем до кода)

### 17.1 Истина мира: узлы региона (не бесшовный open world)
- **Регион = граф узлов** (10–20): `START -> ... -> EXIT` с ответвлениями.
- Узлы типов: `DRIVE`, `POI`, `HAZARD`, `EXIT`, `GARAGE`.
- Каждый узел — отдельная «сцена» с чётким началом/концом.
- Никакой бесшовной огромной карты в MVP.

### 17.2 Формат контента и тюнинга
- Все таблицы контента лежат в `content/*.lua` (одна точка правды).
- Баланс/числа — в `TUNING.lua` (ручки эксперимента).
- **Жёсткое правило:** код логики **не должен** содержать if-веток по конкретным id (типа `if enemy.id == 'x'`). Логика работает через `def` из таблиц.

### 17.3 Контракт между режимами DRIVE и POI
Определяем минимальный набор данных, который переносится между режимами.

**Общее состояние run:**
- `run.region_seed`, `run.node_id`, `run.threat_level`
- `run.inventory` (тетрис)
- `run.car_state` (детали + панели + статусы)
- `run.active_upgrade_id` (активка на B)

**DRIVE -> POI:**
- `car_state` (в т.ч. battery/fuel/heat)
- `threat_level` и модификаторы региона
- `poi_id`/`poi_layout` + список охраны/аномалий

**POI -> DRIVE:**
- изменения `inventory`
- изменения `car_state` (подцепил паразита, сломал панель, починил предохранитель)
- события-метки: `alarm_triggered`, `chaser_spawned`, `leech_attached`

**Итог узла (result):**
- начисление/потери (лут, ресурсы)
- повреждения/статусы
- обновление `threat_level`

## 18) Сохранения
- Минимум: сохранение **между регионами** (в гараже).
- Дополнительно: быстрый автосейв после каждого узла.

## 18) MVP (вертикальный срез)
**Цель MVP:** 15–20 минут геймплея.
- 1 регион (10 узлов)
- 2 POI (АЗС, сарай)
- 3 угрозы на дороге (мины, магнит, стеклянный дождь)
- 1 дрон + 1 охотник
- 6 апгрейдов (шины/бампер/сканер/EMP/канистра/багажник)
- Гараж: ремонт + установка 1–2 модулей

## 19) Параметры для экспериментов (ручки баланса)
Идея: **сначала играбельная механика**, затем крутим числа. В коде все параметры должны жить в одном месте (`TUNING.lua`), чтобы менять без переписывания логики.

### Стартовые дефолты v0 (можно менять по ощущениям)
- **Drive segment duration:** 45–60 сек.
- **POI raid duration:** 45–90 сек (риск растёт).
- **Speed model:** max_speed 2.2–2.8 tiles/frame (примерно), accel 0.06–0.10, brake 0.10–0.16.
- **Grip:** базовое сцепление 1.0; при дрифте (ручник) сцепление 0.6–0.8.
- **Damage:** лёгкий удар = 1–2 урона панели, сильный = 3–6 + шанс статуса.

### Вопросы-решения (зафиксировать, как только попробуем прототип)

**Решения для MVP (зафиксировано):**
1) **Стиль управления:** A — **скользко-дрифтовый**.
2) **Подача DRIVE:** **эксперимент A/B**
   - A: top-down (машина по центру, мир скроллится)
   - B: pseudo-3D (перспективная дорога + кокпит-оверлей)
   Решение после прототипа.

3) **Игрок в POI:** у игрока есть **HP** и базовые возможности **отбиться/убежать**. При смерти в POI — **провал/эвакуация** по правилам fail state.
4) **Loot drop из багажника:** B — **поднять нельзя** (штраф мгновенный). Реализация: лут «теряется» без спавна на дороге.
5) **Активки:** A — **1 активка на B**. Активку можно **менять** через инвентарь/гараж (swap в utility слот).
6) **Инвентарь:** B — **тетрис-инвентарь** (даёт интересные решения по луту).

**Открытые вопросы (оставляем на плейтест):**
- Точные коэффициенты сцепления/заноса и скорость набора дрифта.
- Сколько времени до роста риска в POI (кривая сложности).
- Нужны ли редкие ситуации, когда loot drop можно вернуть (пока нет).

#### Сюжетное объяснение эвакуации
Чтобы смерть/провал не выглядели «магией», используем простую диегетику:
- У машины есть **аварийный маяк/автопилот-эвакуатор** (или «протокол возврата»), который срабатывает при критическом состоянии.
- В POI игрок — **разведчик в защитном костюме**; смерть = «потеря сознания/фатальное повреждение», эвакуация объясняется тем же протоколом.
- Точная формулировка подаётся через радио/интерфейс (текстом), без сложного сюжета.

## 20) Бэклог идей
- Артефакты с «проклятьями» (бафф + дебафф).
- Погодные сезоны по регионам.
- Контракты/задания в POI.
- Лёгкий «сюжет через радио-сообщения».
- Режим испытаний (time attack по дороге).

- Артефакты с «проклятьями» (бафф + дебафф).
- Погодные сезоны по регионам.
- Контракты/задания в POI.
- Лёгкий «сюжет через радио-сообщения».
- Режим испытаний (time attack по дороге).

- Артефакты с «проклятьями» (бафф + дебафф).
- Погодные сезоны по регионам.
- Контракты/задания в POI.
- Лёгкий «сюжет через радио‑сообщения».
- Режим испытаний (time attack по дороге).


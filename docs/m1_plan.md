# M1 — план работ (вертикальный срез) ✅

Цель M1: замкнутая петля **GARAGE → REGION_MAP → DRIVE → POI → RESULT → GARAGE**.

Формат: чеклист. Отмечайте выполненное так: `- [x]`.

Работаем в проекте tic80/python

---

## 0) Подготовка репозитория (минимум)

* [x] Создать/обновить структуру папок проекта (core / scenes / data / systems).
* [x] Подключить TUNING как единую точку баланса (без балансных чисел в системах).
* [x] Включить режим отладки (флаг + простой вывод состояния).

**Готово, если:** проект запускается и выводит заглушку сцены; есть место для оверлея/логов.

---

## 1) Каркас сцен и переходов

### 1.1 SceneManager

* [x] Реализовать каркас SceneManager (смена текущей сцены).
* [x] Зафиксировать контракт сцены: `enter / update / draw / exit`.

**Готово, если:** можно переключаться между двумя заглушками сцен по кнопке.

### 1.2 Список сцен M1

* [x] GARAGE (заглушка UI)
* [x] REGION_MAP (заглушка UI)
* [x] DRIVE (заглушка симуляции)
* [x] POI (заглушка таймера)
* [x] RESULT (заглушка отчёта)

**Готово, если:** все сцены существуют и переходы между ними работают без краша.

---

## 2) RunState / Profile (минимально жизнеспособный)

* [x] Определить минимальные поля **Profile** (гараж): scrap/апгрейды/состояние машины в гараже.
* [x] Определить минимальные поля **RunState**: seed, текущий узел, состояние машины в ранe, инвентарь рана.
* [x] Зафиксировать правило: профиль живёт между запусками, ран живёт только в памяти.

**Готово, если:** сцены меняют состояние только через этот контракт, без «скрытых» переменных.

---

## 3) GARAGE (точка входа/выхода)

* [x] Экран гаража показывает ключевые статы (хотя бы текстом): HP/топливо/scrap.
* [x] Кнопка **Start Run** создаёт новый RunState (seed + стартовые значения).
* [x] Одно действие в гараже (минимум): «починить» или «поставить апгрейд» (может быть заглушкой, но меняет профиль).

**Готово, если:** из гаража можно стартовать ран и вернуться обратно после RESULT.

---

## 4) REGION_MAP (выбор следующего узла)

* [x] Показать список 5–10 узлов (в M1 можно статический).
* [x] Выбор узла записывается в RunState.
* [x] Кнопка **Go** переводит в DRIVE.

**Готово, если:** выбор узла влияет на DRIVE (хотя бы названием/длительностью/сложностью).

---

## 5) DRIVE (езда + ресурсы)

* [x] Управление машиной (минимум): движение/поворот.
* [x] Расход ресурса (минимум 1): например, топливо зависит от времени/движения.
* [x] Один риск (очень простой): столкновение / опасная зона / штраф.
* [x] Условие окончания сегмента: таймер / дистанция / кнопка «прибыл».

**Готово, если:** DRIVE можно пройти и попасть в POI; ресурсы меняются и видны.

---

## 6) POI (короткая вылазка)

* [x] Таймер рейда (счётчик вниз).
* [x] 1–2 действия: «взять лут», «уйти».
* [x] По истечении таймера — провал/штраф и переход в RESULT.

**Готово, если:** можно успешно выйти из POI и можно провалиться; оба исхода ведут в RESULT.

---

## 7) RESULT (итоги сегмента/рана)

* [x] Рассчитать дельты: полученный лут/scrap, урон машине, расходы.
* [x] Применить дельты к **Profile** (гаражному состоянию).
* [x] Очистить временное состояние рана.
* [x] Кнопка **Back to Garage**.

**Готово, если:** после RESULT в гараже видно, что изменения применились ровно один раз.

---

## 8) SAVE/LOAD (только профиль, только гараж)

* [ ] Загрузка Profile при старте игры.
* [ ] Сохранение Profile после действий в гараже (ремонт/апгрейды).
* [ ] Сохранение Profile перед стартом рана.
* [ ] Сохранение Profile после применения результата (RESULT → GARAGE).
* [ ] Подтверждено: прогресс рана не сохраняем.

**Готово, если:** перезапуск игры сохраняет прогресс гаража, но не продолжает ран.

---

## 9) Debug overlay (обязательно)

* [ ] Оверлей показывает: текущая сцена, seed, узел, HP/топливо/таймер POI/scrap.
* [ ] Переключатель on/off.

**Готово, если:** состояние можно диагностировать без дебаггера.

---

## 10) Финальные проверки M1 (DoD)

* [ ] Пройти петлю 10 раз подряд без краша.
* [ ] Проверить провал: смерть/таймер/штраф → гараж.
* [ ] Проверить, что награды/штрафы не применяются дважды.
* [ ] Проверить, что TUNING реально меняет ощущения (скорость/расход/таймер) без правки логики.

**M1 закрыт, если:** все пункты разделов 0–10 отмечены.
